<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.6.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

    <meta charset="UTF-8" />
    <title>Distrito HipHop</title>
    
    <link rel="stylesheet" href="style.css">
    
  </head>
  <body>
    
    <!-- Pantalla de inicio -->
    <section id="start-screen">
      <img id="logo" src="Assets/logo-expo.webp" alt="">
      
      <section id="texto">
      <p>
        Al apuntar tu dispositivo m√≥vil a cada obra puedes ver y escuchar informaci√≥n relevante.
      </p>
      <p>
        Solo debes aceptar la solicitud de uso de c√°mara de tu dispositivo y seleccionar si es iPhone o Android.
      </p>
      </section>

      <button id="start-btn">Seguir con iPhone</button>
      <a href="android.html"><button class="android">Seguir con Android</button></a>
    </section>


    <!-- Botones para PDFs -->
    <div id="pdfOverlay1" class="pdf-overlay" data-pdf="Assets/marker04.pdf">
      <button id="pdfBtn1" class="pdf-btn">Abrir PDF 1</button>
    </div>
    
    <div id="pdfOverlay2" class="pdf-overlay" data-pdf="Assets/marker05.pdf">
      <button id="pdfBtn2" class="pdf-btn">Abrir PDF 2</button>
    </div>
    
    <div id="pdfOverlay3" class="pdf-overlay" data-pdf="Assets/marker06.pdf">
      <button id="pdfBtn3" class="pdf-btn">Abrir PDF 3</button>
    </div>

    
    <a-scene
      mindar-image="imageTargetSrc: Assets/targets-3.mind"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
    <!-- C√°mara AR con cursor y raycaster (usa .clickable) -->
    <a-camera
      position="0 0 0"
      look-controls="enabled: false"
      cursor="rayOrigin: mouse"
      raycaster="objects: .clickable; interval: 100; far: 20"
    ></a-camera>
    
      <!-- Cargar assets (videos) -->
      <a-assets>
        <video id="video1" src="Assets/marker01-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video2" src="Assets/marker02-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video3" src="Assets/marker03-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video7" src="Assets/marker07-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video9" src="Assets/marker09-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video10" src="Assets/marker10-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video12" src="Assets/marker12-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video13" src="Assets/marker13-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
        <video id="video15" src="Assets/marker15-asset.mp4" loop muted playsinline webkit-playsinline autoplay crossorigin="anonymous" preload="auto"></video>
      </a-assets>

      <!-- Configuraci√≥n de m√∫ltiples marcadores -->
      <a-entity mindar-image-target="targetIndex: 0" id="marker1">
        <a-plane id="videoElement1" src="#video1" position="0 0 0" width="1" height="1.45"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 1" id="marker2">
        <a-plane id="videoElement2" src="#video2" position="0 0 0" width="1" height="0.65"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 2" id="marker3">
        <a-plane id="videoElement3" src="#video3" position="0 0 0" width="1" height="0.75"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 6" id="marker7">
        <a-plane id="videoElement7" src="#video7" position="0 0 0" width="1" height="0.9"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 8" id="marker9">
        <a-plane id="videoElement9" src="#video9" position="0 0 0" width="1" height="0.65"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 9" id="marker10">
        <a-plane id="videoElement10" src="#video10" position="0 0 0" width="1" height="0.65"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 11" id="marker12">
        <a-plane id="videoElement12" src="#video12" position="0 0 0" width="1" height="1"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 12" id="marker13">
        <a-plane id="videoElement13" src="#video13" position="0 0 0" width="1" height="1"></a-plane>
      </a-entity>

      <a-entity mindar-image-target="targetIndex: 14" id="marker15">
        <a-plane id="videoElement15" src="#video15" position="0 0 0" width="1" height="1"></a-plane>
      </a-entity>


      <!-- PDFs -->
      <a-entity mindar-image-target="targetIndex: 3" id="markerPDF1"></a-entity>
      <a-entity mindar-image-target="targetIndex: 4" id="markerPDF2"></a-entity>
      <a-entity mindar-image-target="targetIndex: 5" id="markerPDF3"></a-entity>

    </a-scene>


    <script>
      document.getElementById("start-btn").addEventListener("click", () => {
        // Ocultar la pantalla de inicio
        document.getElementById("start-screen").style.display = "none";

        // Obtener los videos y forzar la reproducci√≥n
        const videos = document.querySelectorAll("video");
        videos.forEach(video => {
          video.muted = false; // Desactivar muteo
          video.play().catch(error => console.log("‚ö†Ô∏è No se pudo reproducir un video:", error));
        });
      });

      // Reproducci√≥n basada en detecci√≥n de marcador
      const setupVideoEvents = (markerId, videoId) => {
        const video = document.getElementById(videoId);
        const marker = document.getElementById(markerId);

        marker.addEventListener("targetFound", () => {
          console.log(`üîπ Marcador ${markerId} detectado, reproduciendo ${videoId}...`);
          video.play().catch(error => console.log(`‚ö†Ô∏è Error al reproducir ${videoId}:`, error));
        });

        marker.addEventListener("targetLost", () => {
          console.log(`üîπ Marcador ${markerId} perdido, pausando ${videoId}...`);
          video.pause();
        });
      };

      // Asignar eventos a cada marcador
      setupVideoEvents("marker1", "video1");
      setupVideoEvents("marker2", "video2");
      setupVideoEvents("marker3", "video3");
      setupVideoEvents("marker7", "video7");
      setupVideoEvents("marker9", "video9");
      setupVideoEvents("marker10", "video10");
      setupVideoEvents("marker12", "video12");
      setupVideoEvents("marker13", "video13");
      setupVideoEvents("marker15", "video15");
    </script>


    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // Ajusta estos mapeos a los IDs reales de tus a-entity marcadores
        const mappings = [
          { markerId: 'marker10', overlayId: 'pdfOverlay1', btnId: 'pdfBtn1', debugName: 'PDF 1' },
          { markerId: 'marker12', overlayId: 'pdfOverlay2', btnId: 'pdfBtn2', debugName: 'PDF 2' },
          { markerId: 'marker15', overlayId: 'pdfOverlay3', btnId: 'pdfBtn3', debugName: 'PDF 3' }
        ];

        // Oculta todos los overlays (aseguro estado inicial)
        const overlays = Array.from(document.querySelectorAll('.pdf-overlay'));
        overlays.forEach(o => o.style.display = 'none');

        // Helper: ocultar todos (para mostrar s√≥lo uno)
        function hideAllOverlays() {
          overlays.forEach(o => o.style.display = 'none');
        }

        // Adjuntar listeners cuando la escena AR est√© lista
        const aScene = document.querySelector('a-scene');
        const attachHandlers = () => {
          mappings.forEach(m => {
            const markerEl = document.getElementById(m.markerId);
            const overlayEl = document.getElementById(m.overlayId);
            const btnEl = document.getElementById(m.btnId);

            if (!markerEl) {
              console.warn(`[AR] marker no encontrado: '${m.markerId}'. Revisa el id del <a-entity>.`);
              return;
            }
            if (!overlayEl || !btnEl) {
              console.warn(`[AR] overlay/button no encontrado para: ${m.debugName} (overlay:${m.overlayId}, btn:${m.btnId})`);
              return;
            }

            // Aseguro estado inicial
            overlayEl.style.display = 'none';

            const pdfUrl = overlayEl.dataset.pdf;
            if (!pdfUrl) {
              console.warn(`[AR] data-pdf no definido en ${m.overlayId}`);
            }

            // Listener nativo del bot√≥n (siempre atado desde inicio)
            const openPdf = (ev) => {
              // Evitamos que el mismo click haga cosas raras
              ev && ev.preventDefault && ev.preventDefault();
              // Esta llamada se hace desde el handler del bot√≥n: gesto de usuario
              window.open(pdfUrl, '_blank', 'noopener');
            };
            btnEl.addEventListener('click', openPdf);
            btnEl.addEventListener('touchend', (ev) => { ev.preventDefault(); openPdf(ev); }, { passive: false });

            // Eventos MindAR: s√≥lo mostrar el overlay correspondiente
            markerEl.addEventListener('targetFound', () => {
              console.log(`[AR] marker encontrado: ${m.markerId} ‚Üí mostrando ${m.overlayId}`);
              hideAllOverlays();            // oculto los dem√°s
              overlayEl.style.display = 'block';
            });

            markerEl.addEventListener('targetLost', () => {
              console.log(`[AR] marker perdido: ${m.markerId} ‚Üí ocultando ${m.overlayId}`);
              overlayEl.style.display = 'none';
            });
          });
        };

        if (aScene) {
          if (aScene.hasLoaded) attachHandlers();
          else aScene.addEventListener('loaded', attachHandlers);
        } else {
          // fallback: si no hay <a-scene> (por alg√∫n motivo), intento attach pasado un tick
          setTimeout(attachHandlers, 600);
        }
      });
    </script>

  </body>
</html>